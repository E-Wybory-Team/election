@page "/voterdelete/{voterId:int}"
@using System.ComponentModel.DataAnnotations
@inject NavigationManager NavigationManager
<link href="forms.css" rel="stylesheet" />

<div class="form-container">
    <h1>USUWANIE WYBORCY Z OBWODU</h1>
    <EditForm Model="@voterModel" OnValidSubmit="HandleDeleteSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="form-group-smaller">
            <label for="pesel">PESEL WYBORCY</label>
            <InputText @bind-Value="voterModel.PESEL" id="pesel" class="form-input" readonly />
        </div>
        <div class="form-group-smaller">
            <label for="wojewodztwo">WOJEWÓDZTWO</label>
            <select @bind="voterModel.Wojewodztwo" id="wojewodztwo" class="form-input" readonly>
                <option value="">Wybierz województwo</option>
                @foreach (var woj in voivodeships)
                {
                    <option value="@woj" disabled>@woj</option>
                }
            </select>
        </div>
        <div class="form-group-smaller">
            <label for="powiat">POWIAT</label>
            <select @bind="voterModel.Powiat" id="powiat" class="form-input" readonly>
                <option value="">Wybierz powiat</option>
                @foreach (var pow in counties)
                {
                    <option value="@pow" disabled>@pow</option>
                }
            </select>
        </div>
        <div class="form-group-smaller">
            <label for="gmina">GMINA</label>
            <select @bind="voterModel.Gmina" id="gmina" class="form-input" readonly>
                <option value="">Wybierz gminę</option>
                @foreach (var gmina in provinces)
                {
                    <option value="@gmina" disabled>@gmina</option>
                }
            </select>
        </div>
        <div class="form-group-smaller">
            <label for="numer-obwodu">NUMER OBWODU</label>
            <select @bind="voterModel.NumerObwodu" id="numer-obwodu" class="form-input" readonly>
                <option value="">Wybierz numer obwodu</option>
                @foreach (var obwod in districtNumbers)
                {
                    <option value="@obwod" disabled>@obwod</option>
                }
            </select>
        </div>

        <div class="form-row">
            <button type="submit" class="red-submit-button">USUŃ</button>
            <button type="button" class="submit-button" @onclick="Cancel">ANULUJ</button>
        </div>
    </EditForm>
</div>

@code {
    [Parameter]
    public int voterId { get; set; }

    private VoterModel voterModel = new VoterModel();

    private List<string> voivodeships = new() { "Mazowieckie", "Śląskie", "Małopolskie" };
    private List<string> counties = new() { "Powiat 1", "Powiat 2", "Powiat 3" };
    private List<string> provinces = new() { "Gmina 1", "Gmina 2", "Gmina 3" };
    private List<string> districtNumbers = new() { "Obwód 1", "Obwód 2", "Obwód 3" };

    protected override void OnInitialized()
    {
        var voter = GetVoterById(voterId);
        if (voter != null)
        {
            voterModel = new VoterModel
                {
                    PESEL = voter.Person.PESEL.ToString(),
                    Wojewodztwo = "Mazowieckie",
                    Powiat = "Powiat 1",
                    Gmina = "Gmina 1",
                    NumerObwodu = "Obwód 1"
                };
        }
    }

    private ElectionUser? GetVoterById(int id)
    {
        // Mockowanie danych wyborcy
        var voters = new List<ElectionUser>
        {
            new ElectionUser { IdElectionUser = 1, Person = new People { PESEL = 85293128490 } },
            new ElectionUser { IdElectionUser = 2, Person = new People { PESEL = 92731028594 } }
        };
        return voters.FirstOrDefault(v => v.IdElectionUser == id);
    }

    private void HandleDeleteSubmit()
    {
        Console.WriteLine($"Usunięto wyborcę o numerze PESEL: {voterModel.PESEL}");
        NavigationManager.NavigateTo("/voterslist");
    }

    private void Cancel()
    {
        NavigationManager.NavigateTo("/voterslist");
    }

    public class VoterModel
    {
        public string PESEL { get; set; }
        public string Wojewodztwo { get; set; }
        public string Powiat { get; set; }
        public string Gmina { get; set; }
        public string NumerObwodu { get; set; }
    }

    public class ElectionUser
    {
        public int IdElectionUser { get; set; }
        public People Person { get; set; }
    }

    public class People
    {
        public long PESEL { get; set; }
    }
}
